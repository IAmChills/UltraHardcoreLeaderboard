local Achievements = {

--{ achId="Test",  title="Wolfslayer Test",  level=8, desc="Kill |cff0091e6a wolf", icon=134400, points=10, requiredQuestId=nil, targetNpcId=299, faction="Alliance" },
--{ achId="Test2", title="Easy Quest Test", level=8, desc="Human starter quest", icon=134400, points=10, requiredQuestId=783, targetNpcId=nil, faction="Alliance" },

-- Alliance
{
    achId = "Rageclaw",
    title = "Claw of the Wilds",
    level = 9,
    desc = "Kill |cff0091e6Rageclaw|r and complete |cff0091e6Druid of the Claw|r before level 10",
    icon = 134297,
    points = 10,
    requiredQuestId = 2561,
    targetNpcId = nil,
    faction = "Alliance"
}, {
    achId = "Vagash",
    title = "The Alpha's End",
    level = 10,
    desc = "Kill |cff0091e6Vagash|r and complete |cff0091e6Protecting the Herd|r before level 11",
    icon = 132189,
    points = 10,
    requiredQuestId = 314,
    targetNpcId = nil,
    faction = "Alliance"
}, {
    achId = "Hogger",
    title = "Hogger? Never Heard of Her",
    level = 11,
    desc = "Kill |cff0091e6Hogger|r and complete |cff0091e6Wanted: “Hogger”|r before level 12",
    icon = 134163,
    points = 10,
    requiredQuestId = 176,
    targetNpcId = nil,
    faction = "Alliance"
}, {
    achId = "Grawmug",
    title = "Defender of Dun Algaz",
    level = 16,
    desc = "Kill |cff0091e6Grawmug|r and complete |cff0091e6In Defense of the King’s Land|r before level 17",
    icon = 236421,
    points = 10,
    requiredQuestId = 217,
    targetNpcId = nil,
    faction = "Alliance"
}, {
    achId = "AbsentMindedProspector",
    title = "Absent-Minded Savior",
    level = 19,
    desc = "Complete |cff0091e6Absent Minded Prospector|r before level 20",
    icon = 236444,
    points = 10,
    requiredQuestId = 731,
    targetNpcId = nil,
    faction = "Alliance"
}, {
    achId = "Fangore",
    title = "Lieutenant’s Downfall",
    level = 23,
    desc = "Kill |cff0091e6Lieutenant Fangore|r and complete |cff0091e6Wanted: Lieutenant Fangore|r before level 24",
    icon = 134296,
    points = 10,
    requiredQuestId = 180,
    targetNpcId = nil,
    faction = "Alliance"
}, {
    achId = "Foulborne",
    title = "Summoner’s Bane",
    level = 23,
    desc = "Kill |cff0091e6Sarilus Foulborne|r and complete |cff0091e6Mage Summoner|r before level 24",
    icon = 134173,
    points = 10,
    requiredQuestId = 1017,
    targetNpcId = nil,
    faction = "Alliance"
}, {
    achId = "Nekrosh",
    title = "Nek’rosh No More",
    level = 31,
    desc = "Kill |cff0091e6Chieftan Nek’rosh|r and complete |cff0091e6Defeat Nek’rosh|r before level 32",
    icon = 134170,
    points = 10,
    requiredQuestId = 474,
    targetNpcId = nil,
    faction = "Alliance"
}, {
    achId = "MorLadim",
    title = "Mor’Ladim’s Rest",
    level = 33,
    desc = "Kill |cff0091e6Mor’Ladim|r and complete |cff0091e6Mor’Ladim|r before level 34",
    icon = 133730,
    points = 10,
    requiredQuestId = 228,
    targetNpcId = nil,
    faction = "Alliance"
}, {
    achId = "ForsakenCourier",
    title = "Courier of Death",
    level = 34,
    desc = "Kill the |cff0091e6Forsaken Courier|r and complete |cff0091e6Hints of a New Plague|r before level 35",
    icon = 133470,
    points = 10,
    requiredQuestId = 658,
    targetNpcId = nil,
    faction = "Alliance"
}, {
    achId = "StinkysEscape",
    title = "Stinky Situation",
    level = 34,
    desc = "Complete |cff0091e6Stinky’s Escape|r before level 35",
    icon = 236758,
    points = 10,
    requiredQuestId = 1222,
    targetNpcId = nil,
    faction = "Alliance"
}, {
    achId = "ThogrunAlliance",
    title = "Tremors Beneath",
    level = 40,
    desc = "Kill |cff0091e6Boss Tho’grun|r and complete |cff0091e6Tremors of the Earth|r before level 41",
    icon = 254093,
    points = 10,
    requiredQuestId = 732,
    targetNpcId = nil,
    faction = "Alliance"
}, {
    achId = "LordShalzaru",
    title = "Lord of the Depths",
    level = 43,
    desc = "Kill |cff0091e6Lord Shalzaru|r and complete |cff0091e6Against Lord Shalzaru|r before level 44",
    icon = 136098,
    points = 10,
    requiredQuestId = 2870,
    targetNpcId = nil,
    faction = "Alliance"
}, {
    achId = "DragonkinMenace",
    title = "Wrath of the Dragonkin",
    level = 57,
    desc = "Complete |cff0091e6Dragonkin Menace|r before level 58",
    icon = 236734,
    points = 10,
    requiredQuestId = 4182,
    targetNpcId = nil,
    faction = "Alliance"
},

-- Horde (new)
{
    achId = "Dargol",
    title = "Crypt Commander",
    level = 11,
    desc = "Kill |cff0091e6Captain Dargol|r and complete |cff0091e6The Family Crypt|r before level 12",
    icon = 236458,
    points = 10,
    requiredQuestId = 408,
    targetNpcId = nil,
    faction = "Horde"
}, {
    achId = "Arrachea",
    title = "Spirit of the Earthmother",
    level = 11,
    desc = "Kill |cff0091e6Arra’chea|r and complete |cff0091e6Rites of the Earthmother|r before level 12",
    icon = 132243,
    points = 10,
    requiredQuestId = 776,
    targetNpcId = nil,
    faction = "Horde"
}, {
    achId = "Gazzuz",
    title = "Burning Shadows",
    level = 12,
    desc = "Kill |cff0091e6Gazz’uz|r and complete |cff0091e6Burning Shadows|r before level 13",
    icon = 134085,
    points = 10,
    requiredQuestId = 832,
    targetNpcId = nil,
    faction = "Horde"
}, {
    achId = "Goggeroc",
    title = "Stone and Soil",
    level = 20,
    desc = "Kill |cff0091e6Goggeroc|r and complete |cff0091e6Earthen Arise|r before level 21",
    icon = 236831,
    points = 10,
    requiredQuestId = 6481,
    targetNpcId = nil,
    faction = "Horde"
}, {
    achId = "Kromzar",
    title = "Counterattack!",
    level = 20,
    desc = "Kill |cff0091e6Warlord Krom’zar|r and complete |cff0091e6Counterattack!|r before level 21",
    icon = 132484,
    points = 10,
    requiredQuestId = 4021,
    targetNpcId = nil,
    faction = "Horde"
}, {
    achId = "Ataeric",
    title = "Thread of the Weaver",
    level = 20,
    desc = "Kill |cff0091e6Archmage Ataeric|r and complete |cff0091e6The Weaver|r before level 21",
    icon = 135144,
    points = 10,
    requiredQuestId = 480,
    targetNpcId = nil,
    faction = "Horde"
}, {
    achId = "TheHunt",
    title = "The Great Hunt",
    level = 26,
    desc = "Complete |cff0091e6The Hunt Completed|r by slaying |cff0091e6Shadumbra|r, |cff0091e6Sharptalon|r, and |cff0091e6Ursangous|r before level 27",
    icon = 236713,
    points = 10,
    requiredQuestId = 247,
    targetNpcId = nil,
    faction = "Horde"
}, {
    achId = "Grenka",
    title = "What's in the Box!?",
    level = 30,
    desc = "Kill |cff0091e6Grenka Bloodscreech|r and complete |cff0091e6Test of Endurance|r before level 31",
    icon = 236848,
    points = 10,
    requiredQuestId = 1150,
    targetNpcId = nil,
    faction = "Horde"
}, {
    achId = "Ironhill",
    title = "Hillsbrad Commander",
    level = 33,
    desc = "Kill |cff0091e6Captain Ironhill|r and complete |cff0091e6Battle of Hillsbrad|r before level 34",
    icon = 236779,
    points = 10,
    requiredQuestId = 541,
    targetNpcId = nil,
    faction = "Horde"
}, {
    achId = "ThogrunHorde",
    title = "Sign of the Earth",
    level = 40,
    desc = "Kill |cff0091e6Boss Tho’grun|r and complete |cff0091e6Broken Alliances|r before level 41",
    icon = 254093,
    points = 10,
    requiredQuestId = 782,
    targetNpcId = nil,
    faction = "Horde"
}, {
    achId = "NothingButTruth",
    title = "Truth Seeker",
    level = 40,
    desc = "Complete |cff0091e6Nothing but the Truth|r before level 41",
    icon = 132800,
    points = 10,
    requiredQuestId = 1391,
    targetNpcId = nil,
    faction = "Horde"
}, {
    achId = "Mugthol",
    title = "Crowned",
    level = 43,
    desc = "Kill |cff0091e6Mug’thol|r and complete |cff0091e6The Crown of Will|r before level 44",
    icon = 132768,
    points = 10,
    requiredQuestId = 520,
    targetNpcId = nil,
    faction = "Horde"
}, {
    achId = "Hatetalon",
    title = "Dark Heart of the Wild",
    level = 48,
    desc = "Kill |cff0091e6Edana Hatetalon|r and complete |cff0091e6Dark Heart|r before level 49",
    icon = 134131,
    points = 10,
    requiredQuestId = 3062,
    targetNpcId = nil,
    faction = "Horde"
}, {
    achId = "Kromgrul",
    title = "Crushing the Grul",
    level = 51,
    desc = "Kill |cff0091e6Krom’Grul|r and complete |cff0091e6Krom’Grul|r before level 52",
    icon = 236695,
    points = 10,
    requiredQuestId = 3822,
    targetNpcId = nil,
    faction = "Horde"
}, {
    achId = "Hitahya",
    title = "Keeper of Keys",
    level = 56,
    desc = "Kill |cff0091e6Hitah’ya the Keeper|r and complete |cff0091e6Recover the Key|r before level 57",
    icon = 236780,
    points = 10,
    requiredQuestId = 7846,
    targetNpcId = nil,
    faction = "Horde"
},

-- Neutral (no faction)
{
    achId = "Level10",
    title = "This Isn't Too Bad...",
    level = 10,
    desc = "Reach level 10 without dying",
    icon = 894556,
    points = 10,
    customIsCompleted = function() return (UnitLevel("player") or 1) >= 10 end,
    staticPoints = true,
}, {
    achId = "Level20",
    title = "Roaring Twenties",
    level = 20,
    desc = "Reach level 20 without dying",
    icon = 894556,
    points = 20,
    customIsCompleted = function() return (UnitLevel("player") or 1) >= 20 end,
    staticPoints = true,
}, {
    achId = "Level30",
    title = "Thirty and Flirty",
    level = 30,
    desc = "Reach level 30 without dying",
    icon = 894556,
    points = 30,
    customIsCompleted = function() return (UnitLevel("player") or 1) >= 30 end,
    staticPoints = true,
}, {
    achId = "Level40",
    title = "Over the Hill",
    level = 40,
    desc = "Reach level 40 without dying",
    icon = 894556,
    points = 40,
    customIsCompleted = function() return (UnitLevel("player") or 1) >= 40 end,
    staticPoints = true,
}, {
    achId = "Level50",
    title = "Lock In",
    level = 50,
    desc = "Reach level 50 without dying",
    icon = 894556,
    points = 50,
    customIsCompleted = function() return (UnitLevel("player") or 1) >= 50 end,
    staticPoints = true,
}, {
    achId = "Level60",
    title = "It's Been Sixty Years...",
    level = 60,
    desc = "Reach level 60 without dying",
    icon = 894556,
    points = 60,
    customIsCompleted = function() return (UnitLevel("player") or 1) >= 60 end,
    staticPoints = true,
}, {
    achId = "GalensEscape",
    title = "Galen’s Freedom",
    level = 38,
    desc = "Complete |cff0091e6Galen’s Escape|r before level 39",
    icon = 236845,
    points = 10,
    requiredQuestId = 1393,
    targetNpcId = nil
}, {
    achId = "KingBangalash",
    title = "King of the Jungle",
    level = 39,
    desc = "Kill |cff0091e6King Bangalash|r and complete |cff0091e6Big Game Hunter|r before level 40",
    icon = 134176,
    points = 10,
    requiredQuestId = 208,
    targetNpcId = nil
}, {
    achId = "GetMeOutOfHere",
    title = "Outta Here!",
    level = 41,
    desc = "Complete |cff0091e6Get Me Out of Here!|r before level 42",
    icon = 236742,
    points = 10,
    requiredQuestId = 6132,
    targetNpcId = nil
}, {
    achId = "OOX",
    title = "Oox I Did It Again",
    level = 45,
    desc = "Complete |cff0091e6An OOX of Your Own|r before level 46",
    icon = 133883,
    points = 10,
    requiredQuestId = 3721,
    targetNpcId = nil
}, {
    achId = "CuergosGold",
    title = "Cuergo’s Fortune",
    level = 45,
    desc = "Complete |cff0091e6Cuergo’s Gold|r before level 46",
    icon = 237387,
    points = 10,
    requiredQuestId = 2882,
    targetNpcId = nil
}, {
    achId = "Mukla",
    title = "King of the Jungle",
    level = 48,
    desc = "Kill |cff0091e6King Mukla|r and complete |cff0091e6Message in a Bottle|r before level 49",
    icon = 132159,
    points = 10,
    requiredQuestId = 630,
    targetNpcId = nil
}, {
    achId = "MalletZF",
    title = "Bang a Gong",
    level = 49,
    desc = "Obtain the |cff0091e6Mallet of Zul'Farrak|r before level 50",
    icon = 134559,
    points = 10,
    itemId = 9241,
    customIsCompleted = function() return GetItemCount(9241, true) > 0 end
}, {
    achId = "Hakkar",
    title = "Spirits, Tablets, Eggs, Oh My!",
    level = 50,
    desc = "Complete |cff0091e6The God Hakkar|r before level 51",
    icon = 132209,
    points = 10,
    requiredQuestId = 3528,
    targetNpcId = nil
}, {
    achId = "KimJaelIndeed",
    title = "Booty Bay Genius",
    level = 51,
    desc = "Complete |cff0091e6Kim’Jael Indeed!|r before level 52",
    icon = 236714,
    points = 10,
    requiredQuestId = 3601,
    targetNpcId = nil
}, {
    achId = "StonesThatBindUs",
    title = "Stonebound Savior",
    level = 51,
    desc = "Complete |cff0091e6The Stones That Bind Us|r before level 52",
    icon = 236720,
    points = 10,
    requiredQuestId = 2681,
    targetNpcId = nil
}, {
    achId = "ShadowLordFeldan",
    title = "Shadow’s End",
    level = 55,
    desc = "Kill |cff0091e6Shadow Lord Fel’dan|r and complete |cff0091e6A Final Blow|r before level 56",
    icon = 236763,
    points = 10,
    requiredQuestId = 5242,
    targetNpcId = nil
}, {
    achId = "SummoningThePrincess",
    title = "Shards of Myzrael",
    level = 55,
    desc = "Kill |cff0091e6Myzrael|r and complete |cff0091e6Summoning the Princess|r before level 56",
    icon = 4571434,
    points = 10,
    requiredQuestId = 656,
    targetNpcId = nil
}, {
    achId = "GorishiHiveQueen",
    title = "Queen’s Gambit",
    level = 56,
    desc = "Kill |cff0091e6Gorishi Hive Queen|r and complete |cff0091e6Pawn Captures Queen|r before level 57",
    icon = 134340,
    points = 10,
    requiredQuestId = 4507,
    targetNpcId = nil
}, {
    achId = "OverseerMaltorius",
    title = "Master of the Forge",
    level = 56,
    desc = "Kill |cff0091e6Overseer Maltorius|r and complete |cff0091e6WANTED: Overseer Maltorius|r before level 57",
    icon = 134159,
    points = 10,
    requiredQuestId = 7701,
    targetNpcId = nil
}, {
    achId = "MercutioFilthgorger",
    title = "Mercutio’s Memory",
    level = 57,
    desc = "Kill |cff0091e6Mercutio Filthgorger|r and complete |cff0091e6Of Forgotten Memories|r before level 58",
    icon = 133038,
    points = 10,
    requiredQuestId = 5781,
    targetNpcId = nil
}, {
    achId = "HighChiefWinterfall",
    title = "Winter is Coming",
    level = 59,
    desc = "Kill |cff0091e6High Chief Winterfall|r and complete |cff0091e6High Chief Winterfall|r before level 60",
    icon = 236696,
    points = 10,
    requiredQuestId = 5121,
    targetNpcId = nil
}, {
    achId = "Deathclasp",
    title = "Deathclasp Down",
    level = 59,
    desc = "Kill |cff0091e6Deathclasp|r and complete |cff0091e6Wanted: Deathclasp, Terror of the Sands|r before level 60",
    icon = 133708,
    points = 10,
    requiredQuestId = 8283,
    targetNpcId = nil
}
}

local function HCA_NormalizePreset(p)
  p = tostring(p or ""):lower()
  p = p:gsub("%+","plus")      -- keep plus as text
       :gsub("%s+","")         -- remove spaces
       :gsub("[^%w]","")       -- drop any remaining punctuation
  return p
end

local POINT_MULTIPLIER = {
  lite            = 1.20,  -- 10 -> 12
  liteplus        = 1.30,  -- 10 -> 13
  recommended     = 1.50,  -- 10 -> 15
  recommendedplus = 1.60,  -- 10 -> 16
  ultra           = 1.70,  -- 10 -> 17
  ultraplus       = 1.80,  -- 10 -> 18
  experimental    = 2.00,  -- 10 -> 20
  custom          = 1.00,  -- unchanged
}

local PLAYER_PRESET = HCA_GetPlayerPreset()

local function HCA_AdjustPoints(basePoints, PLAYER_PRESET)
  local mult = POINT_MULTIPLIER[HCA_NormalizePreset(PLAYER_PRESET)] or 1.00
  -- round to nearest integer so totals are clean
  return math.floor((basePoints or 0) * mult + 0.5)
end

local function IsEligible(def)
  -- Faction: "Alliance" / "Horde"
  if def.faction and UnitFactionGroup("player") ~= def.faction then
    return false
  end

  -- Race: allow either raceFile or localized race name in the def
  if def.race then
    local raceName, raceFile = UnitRace("player")
    if def.race ~= raceFile and def.race ~= raceName then
      return false
    end
  end

  -- Class: use class file tokens ("MAGE","WARRIOR",...)
  if def.class then
    local _, classFile = UnitClass("player")
    if classFile ~= def.class then
      return false
    end
  end

  return true
end

for _, def in ipairs(Achievements) do
  if IsEligible(def) then
    if def.customKill then
      _G[def.achId .. "_Kill"] = def.customKill
      _G[def.achId .. "_IsCompleted"] = _G[def.achId .. "_IsCompleted"] or function() return false end
    elseif def.customIsCompleted then
      _G[def.achId .. "_IsCompleted"] = def.customIsCompleted
    else
      _G.Achievements_Common.registerQuestAchievement{
        achId           = def.achId,
        requiredQuestId = def.requiredQuestId,
        targetNpcId     = def.targetNpcId,
        maxLevel        = def.level,
        faction         = def.faction,
        race            = def.race,
        class           = def.class,
      }
    end
  end
end

for _, def in ipairs(Achievements) do
  if IsEligible(def) then
    local killFn  = def.customKill or (def.targetNpcId and _G[def.achId .. "_Kill"]) or nil
    local questFn = (def.requiredQuestId and _G[def.achId .. "_Quest"]) or nil

    local effectivePoints = def.staticPoints and (def.points or 0) or HCA_AdjustPoints(def.points or 0, PLAYER_PRESET)

    CreateAchievementRow(
      AchievementPanel,
      def.achId,
      def.title,
      ("Level %d"):format(def.level),
      def.desc,
      def.icon,
      def.level,
      effectivePoints,
      killFn,
      questFn
    )
  end
end
